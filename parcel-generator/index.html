<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flash Express Shipping Label Generator</title>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #ff6b35;
        }

        .controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .location-selector {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }

        .location-selector label {
            font-weight: bold;
            color: #ff6b35;
        }

        .location-selector select {
            padding: 8px 12px;
            border: 2px solid #ff6b35;
            border-radius: 4px;
            font-size: 14px;
            background: white;
            color: #333;
            min-width: 150px;
        }

        .location-selector select:focus {
            outline: none;
            border-color: #e55a2b;
            box-shadow: 0 0 5px rgba(255, 107, 53, 0.3);
        }

        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            background: #ff6b35;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn:hover {
            background: #e55a2b;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #3498db;
        }

        .btn-secondary:hover {
            background: #2980b9;
        }

        .btn-success {
            background: #27ae60;
        }

        .btn-success:hover {
            background: #219653;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }

        /* Shipping Label Styles */
        .shipping-label {
            width: 400px;
            border: 3px solid #000;
            font-family: Arial, sans-serif;
            font-size: 11px;
            margin: 20px auto;
            background: white;
            position: relative;
        }

        .header {
            display: flex;
            align-items: center;
            padding: 8px;
            border-bottom: 2px solid #000;
        }

        .flash-logo {
            background: #ff6b35;
            color: white;
            padding: 4px 8px;
            font-weight: bold;
            font-size: 14px;
            margin-right: 10px;
            text-align: center;
            line-height: 1.2;
        }

        .tracking-number {
            font-size: 24px;
            font-weight: bold;
            flex: 1;
        }

        .hub-code {
            font-weight: bold;
            background: #000;
            color: white;
            padding: 2px 6px;
            margin-left: 10px;
        }

        .rts-info {
            padding: 4px 8px;
            border-bottom: 1px solid #000;
            font-size: 10px;
        }

        .order-section {
            padding: 4px 8px;
            border-bottom: 2px solid #000;
        }

        .order-id {
            font-weight: bold;
        }

        .barcode-section {
            text-align: center;
            padding: 10px;
            border-bottom: 2px solid #000;
        }

        .barcode-container {
            height: 50px;
            margin: 5px 0;
        }

        .ph-number {
            text-align: center;
            font-weight: bold;
            margin-top: 5px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            letter-spacing: 1px;
        }

        .address-section {
            display: flex;
        }

        .buyer-section, .seller-section {
            flex: 1;
            padding: 8px;
            border-right: 1px solid #000;
            position: relative;
        }

        .seller-section {
            border-right: none;
        }

        .section-label {
            background: #000;
            color: white;
            padding: 2px 4px;
            font-weight: bold;
            font-size: 10px;
            margin-bottom: 5px;
            float: left;
            margin-right: 5px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .address-content {
            margin-left: 25px;
            font-size: 10px;
            line-height: 1.3;
        }

        .name {
            font-weight: bold;
            margin-bottom: 3px;
        }

        .cod-section {
            display: flex;
            border-top: 2px solid #000;
        }

        .product-info {
            flex: 1;
            padding: 8px;
            border-right: 1px solid #000;
        }

        .qr-section {
            width: 80px;
            padding: 8px;
            text-align: center;
            border-right: 1px solid #000;
        }

        .qr-code {
            width: 60px;
            height: 60px;
            border: 2px solid #000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8px;
            margin-bottom: 5px;
        }

        .delivery-attempts {
            width: 80px;
            padding: 8px;
            text-align: center;
        }

        .attempt-boxes {
            display: flex;
            gap: 5px;
            margin-top: 5px;
        }

        .attempt-box {
            width: 20px;
            height: 20px;
            border: 2px solid #000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .footer {
            text-align: center;
            background: #ff6b35;
            color: white;
            padding: 8px;
            font-weight: bold;
            font-size: 12px;
        }

        .guarantee-text {
            font-size: 8px;
            margin-top: 2px;
        }

        .hidden {
            display: none;
        }

        .label-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin-top: 30px;
        }

        .label-wrapper {
            position: relative;
        }

        .label-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
        }

        .action-btn {
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            border-radius: 3px;
            padding: 3px 6px;
            font-size: 10px;
            cursor: pointer;
        }

        @media print {
            body {
                background: white;
            }
            .container {
                box-shadow: none;
                padding: 0;
            }
            .controls, .btn-group {
                display: none;
            }
            .label-container {
                margin-top: 0;
            }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: #27ae60;
            color: white;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            transform: translateX(200%);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .notification.show {
            transform: translateX(0);
        }

        .counter {
            text-align: center;
            margin: 15px 0;
            font-weight: bold;
            color: #ff6b35;
        }
        
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            color: white;
            font-size: 24px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Flash Express Shipping Label Generator</h1>
        
        <div class="controls">
            <div class="location-selector">
                <label for="barangaySelect">Barangay:</label>
                <select id="barangaySelect" onchange="updateDistrictOptions()">
                    <option value="random">Random</option>
                </select>
                
                <label for="districtSelect">District:</label>
                <select id="districtSelect">
                    <option value="random">Random</option>
                </select>
            </div>
            
            <div class="button-group">
                <button class="btn" onclick="generateSingleLabel()">Generate Single Label</button>
                <button class="btn btn-secondary" onclick="generateBulkLabels()">Generate 5 Labels</button>
                <button class="btn btn-success" onclick="downloadAllLabelsAsPDF()">Download All as PDF</button>
            </div>
        </div>
        
        <div class="counter">Generated Labels: <span id="labelCount">0</span></div>
        
        <div id="labelContainer" class="label-container">
            <!-- Labels will be generated here -->
        </div>
    </div>
    
    <div id="notification" class="notification">Label saved successfully!</div>
    <div id="loading" class="loading">Generating PDF...</div>

    <script>
        // Initialize jsPDF
        const { jsPDF } = window.jspdf;
        
        // Updated Barangay Data for Flash Express delivery scope (based on Gaya-Gaya warehouse)
        const barangays = [
            {
                name: "Muzon",
                municipality: "San Jose del Monte",
                province: "Bulacan",
                districts: [
                    { name: "North", code: "MZN1", rider: "GY01", rtsCode: "FEX-BUL-SJDM-MZN1-GY01" },
                    { name: "South", code: "MZN2", rider: "GY02", rtsCode: "FEX-BUL-SJDM-MZN2-GY02" },
                    { name: "Central", code: "MZN3", rider: "GY03", rtsCode: "FEX-BUL-SJDM-MZN3-GY03" },
                    { name: "Proper", code: "MZN4", rider: "GY04", rtsCode: "FEX-BUL-SJDM-MZN4-GY04" }
                ]
            },
            {
                name: "Graceville",
                municipality: "San Jose del Monte",
                province: "Bulacan",
                districts: [
                    { name: "Subdivision", code: "GRC1", rider: "GY05", rtsCode: "FEX-BUL-SJDM-GRC1-GY05" },
                    { name: "Main", code: "GRC2", rider: "GY06", rtsCode: "FEX-BUL-SJDM-GRC2-GY06" },
                    { name: "Commercial", code: "GRC3", rider: "GY07", rtsCode: "FEX-BUL-SJDM-GRC3-GY07" }
                ]
            },
            {
                name: "Poblacion I",
                municipality: "San Jose del Monte",
                province: "Bulacan",
                districts: [
                    { name: "Central District", code: "POB1", rider: "GY08", rtsCode: "FEX-BUL-SJDM-POB1-GY08" },
                    { name: "Downtown", code: "POB2", rider: "GY09", rtsCode: "FEX-BUL-SJDM-POB2-GY09" },
                    { name: "Main", code: "POB3", rider: "GY10", rtsCode: "FEX-BUL-SJDM-POB3-GY10" }
                ]
            },
            {
                name: "Loma de Gato",
                municipality: "San Jose del Monte",
                province: "Bulacan",
                districts: [
                    { name: "Marilao Border", code: "LDG1", rider: "GY11", rtsCode: "FEX-BUL-SJDM-LDG1-GY11" },
                    { name: "Residential", code: "LDG2", rider: "GY12", rtsCode: "FEX-BUL-SJDM-LDG2-GY12" },
                    { name: "Main", code: "LDG3", rider: "GY13", rtsCode: "FEX-BUL-SJDM-LDG3-GY13" }
                ]
            },
            {
                name: "Bagong Silang (Brgy 176)",
                municipality: "San Jose del Monte",
                province: "Bulacan",
                districts: [
                    { name: "Caloocan Border", code: "BS01", rider: "GY14", rtsCode: "FEX-BUL-SJDM-BS01-GY14" },
                    { name: "Metro Manila Border", code: "BS02", rider: "GY15", rtsCode: "FEX-BUL-SJDM-BS02-GY15" },
                    { name: "Main", code: "BS03", rider: "GY16", rtsCode: "FEX-BUL-SJDM-BS03-GY16" }
                ]
            },
            {
                name: "Gaya-Gaya",
                municipality: "San Jose del Monte",
                province: "Bulacan",
                districts: [
                    { name: "Warehouse District", code: "GYG1", rider: "HUB", rtsCode: "FEX-BUL-SJDM-GYG1-HUB" },
                    { name: "Main", code: "GYG2", rider: "GY17", rtsCode: "FEX-BUL-SJDM-GYG2-GY17" },
                    { name: "Central", code: "GYG3", rider: "GY18", rtsCode: "FEX-BUL-SJDM-GYG3-GY18" }
                ]
            },
            {
                name: "Sapang Palay",
                municipality: "San Jose del Monte",
                province: "Bulacan",
                districts: [
                    { name: "West", code: "SPY1", rider: "GY19", rtsCode: "FEX-BUL-SJDM-SPY1-GY19" },
                    { name: "East", code: "SPY2", rider: "GY20", rtsCode: "FEX-BUL-SJDM-SPY2-GY20" },
                    { name: "Central", code: "SPY3", rider: "GY21", rtsCode: "FEX-BUL-SJDM-SPY3-GY21" }
                ]
            },
            {
                name: "Tungko",
                municipality: "San Jose del Monte",
                province: "Bulacan",
                districts: [
                    { name: "Main", code: "TKO1", rider: "GY22", rtsCode: "FEX-BUL-SJDM-TKO1-GY22" },
                    { name: "Subdivision", code: "TKO2", rider: "GY23", rtsCode: "FEX-BUL-SJDM-TKO2-GY23" }
                ]
            }
        ];
        
        const firstNames = ["John", "Jane", "Michael", "Sarah", "David", "Emma", "Chris", "Lisa", "James", "Maria", "Robert", "Jennifer", "William", "Linda", "Thomas", "Jose", "Ana", "Carlos", "Rosa", "Miguel"];
        const lastNames = ["Smith", "Johnson", "Williams", "Brown", "Jones", "Garcia", "Miller", "Davis", "Rodriguez", "Martinez", "Hernandez", "Lopez", "Gonzalez", "Wilson", "Anderson", "Santos", "Cruz", "Reyes", "Flores", "Morales"];
        const streets = [
            "Mabini St", "Rizal Ave", "Bonifacio St", "Mabuhay St", "Del Pilar St", 
            "Kalayaan Ave", "Maginhawa St", "Kamuning Rd", "Tandang Sora Ave", "Sto. Domingo St",
            "Sta. Mesa St", "España Blvd", "Lacson Ave", "Vicente Cruz St", "Carriedo St",
            "NLEX Service Rd", "Del Monte Ave", "Bulacan Highway", "Main Street"
        ];
        
        let generatedLabels = [];
        let labelCount = 0;
        
        // Initialize location dropdowns
        function initializeLocationDropdowns() {
            const barangaySelect = document.getElementById('barangaySelect');
            const districtSelect = document.getElementById('districtSelect');
            
            // Populate barangay dropdown
            barangays.forEach(barangay => {
                const option = document.createElement('option');
                option.value = barangay.name;
                option.textContent = barangay.name;
                barangaySelect.appendChild(option);
            });
        }
        
        // Update district options based on selected barangay
        function updateDistrictOptions() {
            const barangaySelect = document.getElementById('barangaySelect');
            const districtSelect = document.getElementById('districtSelect');
            const selectedBarangay = barangaySelect.value;
            
            // Clear existing district options
            districtSelect.innerHTML = '<option value="random">Random</option>';
            
            if (selectedBarangay !== 'random') {
                const barangay = barangays.find(b => b.name === selectedBarangay);
                if (barangay) {
                    barangay.districts.forEach(district => {
                        const option = document.createElement('option');
                        option.value = district.name;
                        option.textContent = district.name;
                        districtSelect.appendChild(option);
                    });
                }
            }
        }
        
        // Get selected location or random if not specified
        function getSelectedLocation() {
            const barangaySelect = document.getElementById('barangaySelect');
            const districtSelect = document.getElementById('districtSelect');
            const selectedBarangayName = barangaySelect.value;
            const selectedDistrictName = districtSelect.value;
            
            if (selectedBarangayName === 'random') {
                // Full random selection
                const barangay = barangays[Math.floor(Math.random() * barangays.length)];
                const district = barangay.districts[Math.floor(Math.random() * barangay.districts.length)];
                return { barangay, district };
            } else {
                // Specific barangay selected
                const barangay = barangays.find(b => b.name === selectedBarangayName);
                if (selectedDistrictName === 'random') {
                    // Random district within selected barangay
                    const district = barangay.districts[Math.floor(Math.random() * barangay.districts.length)];
                    return { barangay, district };
                } else {
                    // Specific district selected
                    const district = barangay.districts.find(d => d.name === selectedDistrictName);
                    return { barangay, district };
                }
            }
        }
        
        // Show notification
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // Show loading indicator
        function showLoading() {
            document.getElementById('loading').style.display = 'flex';
        }
        
        // Hide loading indicator
        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }
        
        // Generate random tracking number (Flash Express format)
        function generateTrackingNumber() {
            const prefix = 'FE';
            const middle = Math.floor(Math.random() * 9000000000 + 1000000000);
            return `${prefix}${middle}`;
        }
        
        // Generate random PH number
        function generatePHNumber() {
            return 'FE ' + Math.floor(Math.random() * 900000000000 + 100000000000);
        }
        
        // Generate random order ID
        function generateOrderId() {
            const timestamp = Date.now().toString().substr(-6);
            const random = Math.random().toString(36).substr(2, 6).toUpperCase();
            return 'FE' + timestamp + random;
        }
        
        // Generate random buyer/seller name
        function generateName() {
            const firstName = firstNames[Math.floor(Math.random() * firstNames.length)];
            const lastName = lastNames[Math.floor(Math.random() * lastNames.length)];
            return `${firstName} ${lastName}`;
        }
        
        // Generate random address using selected location or random
        function generateAddress() {
            const { barangay, district } = getSelectedLocation();
            const streetNumber = Math.floor(Math.random() * 500) + 1;
            const street = streets[Math.floor(Math.random() * streets.length)];
            const city = barangay.municipality;
            const province = barangay.province;
            const zipCode = Math.random() > 0.5 ? "3023" : "3024"; // SJDM zip codes
            
            return {
                full: `${streetNumber} ${street}, Brgy. ${barangay.name} ${district.name}, ${city}, ${province} ${zipCode}`,
                barangay: barangay.name,
                district: district.name,
                code: district.code,
                rtsCode: district.rtsCode,
                rider: district.rider
            };
        }
        
        // Generate random weight (max 7kg)
        function generateWeight() {
            return Math.floor(Math.random() * 7000) + 100; // 100g to 7000g
        }
        
        // Generate quantity based on weight (~500g per item)
        function generateQuantity(weight) {
            return Math.max(1, Math.floor(weight / 500));
        }
        
        // Generate hub code
        function generateHubCode() {
            const codes = ["[GY]", "[HUB]", "[FEX]"];
            return codes[Math.floor(Math.random() * codes.length)];
        }
        
        // Generate a single shipping label
        async function generateSingleLabel() {
            const orderId = generateOrderId();
            const trackingNumber = generateTrackingNumber();
            const weight = generateWeight();
            const quantity = generateQuantity(weight);
            const hubCode = generateHubCode();
            const buyerName = generateName();
            const buyerAddress = generateAddress();
            const sellerName = "Flash Express";
            const sellerAddress = "Gaya-Gaya Warehouse, SJDM, Bulacan 3023";
            const phNumber = generatePHNumber();
            
            const labelData = {
                orderId,
                trackingNumber,
                weight,
                quantity,
                hubCode,
                buyerName,
                buyerAddress: buyerAddress.full,
                sellerName,
                sellerAddress,
                rtsCode: buyerAddress.rtsCode,
                rider: buyerAddress.rider,
                phNumber,
                barangayCode: buyerAddress.code,
                districtName: buyerAddress.district
            };
            
            generatedLabels.push(labelData);
            labelCount++;
            document.getElementById('labelCount').textContent = labelCount;
            
            await renderLabel(labelData);
        }
        
        // Generate multiple labels
        function generateBulkLabels() {
            for (let i = 0; i < 5; i++) {
                generateSingleLabel();
            }
        }
        
        // Render a label in the UI
        async function renderLabel(data) {
            const labelContainer = document.getElementById('labelContainer');
            const labelWrapper = document.createElement('div');
            labelWrapper.className = 'label-wrapper';
            
            // Create unique ID for this label
            const labelId = `label-${data.orderId}`;
            
            labelWrapper.innerHTML = `
                <div class="shipping-label" id="${labelId}">
                    <div class="header">
                        <div class="flash-logo">FLASH<br><small style="font-size: 8px;">EXPRESS</small></div>
                        <div class="tracking-number">${data.trackingNumber}</div>
                        <div class="hub-code">${data.hubCode}</div>
                    </div>

                    <div class="rts-info">
                        <div>FEX-GAYA-GAYA-HUB-SJDM</div>
                        <div>RTS Sort Code:</div>
                        <div>${data.rtsCode}</div>
                        <div>Rider: ${data.rider}</div>
                    </div>

                    <div class="order-section">
                        <div class="order-id">Order ID: <span>${data.orderId}</span></div>
                    </div>

                    <div class="barcode-section">
                        <div class="barcode-container">
                            <svg class="barcode" id="barcode-${data.orderId}"></svg>
                        </div>
                        <div class="ph-number">${data.phNumber}</div>
                    </div>

                    <div class="address-section">
                        <div class="buyer-section">
                            <svg class="section-label" width="20" height="60" viewBox="0 0 20 60">
                                <rect width="20" height="60" fill="#000" />
                                <text x="10" y="30" transform="rotate(-90 10 30)" dominant-baseline="middle" text-anchor="middle" font-size="10" fill="white" font-family="Arial">BUYER</text>
                            </svg>
                            <div class="address-content">
                                <div class="name">${data.buyerName}</div>
                                <div>${data.buyerAddress}</div>
                                <br>
                                <div style="display: flex; justify-content: space-between; font-size: 8px;">
                                    <div>District<br>Street</div>
                                    <div>City<br>Province</div>
                                    <div>Zip Code</div>
                                </div>
                            </div>
                            <div style="position: absolute; right: 10px; top: 10px; font-weight: bold;">PDG</div>
                        </div>
                    </div>

                    <div class="address-section">
                        <div class="seller-section">
                            <svg class="section-label" width="20" height="60" viewBox="0 0 20 60">
                                <rect width="20" height="60" fill="#000" />
                                <text x="10" y="30" transform="rotate(-90 10 30)" dominant-baseline="middle" text-anchor="middle" font-size="10" fill="white" font-family="Arial">SELLER</text>
                            </svg>
                            <div class="address-content">
                                <div class="name">${data.sellerName}</div>
                                <div>${data.sellerAddress}</div>
                                <br>
                                <div style="display: flex; justify-content: space-between; font-size: 8px;">
                                    <div>District<br>Street</div>
                                    <div>City<br>Province</div>
                                    <div>Zip Code</div>
                                </div>
                            </div>
                            <div style="position: absolute; right: 10px; top: 10px; font-weight: bold;">COD</div>
                        </div>
                    </div>

                    <div class="cod-section">
                        <div class="product-info">
                            <div>Product Quantity: <span>${data.quantity}</span></div>
                            <div>Weight: <span>${data.weight}g</span></div>
                        </div>
                        
                        <div class="qr-section">
                            <div class="qr-code" id="qr-${data.orderId}"></div>
                        </div>
                        
                        <div class="delivery-attempts">
                            <div style="font-size: 8px;">Delivery Attempt</div>
                            <div class="attempt-boxes">
                                <div class="attempt-box">1</div>
                                <div class="attempt-box">2</div>
                                <div class="attempt-box">3</div>
                            </div>
                        </div>
                        
                        <div class="delivery-attempts">
                            <div style="font-size: 8px;">Return Attempt</div>
                            <div class="attempt-boxes">
                                <div class="attempt-box">1</div>
                                <div class="attempt-box">2</div>
                                <div class="attempt-box">3</div>
                            </div>
                        </div>
                    </div>

                    <div class="footer">
                        FASTEST DELIVERY IN THE PHILIPPINES
                        <div class="guarantee-text">WITH ON-TIME DELIVERY GUARANTEE</div>
                    </div>
                </div>
                <div class="label-actions">
                    <button class="action-btn" onclick="downloadLabelAsPDF('${labelId}')">PDF</button>
                </div>
            `;
            
            labelContainer.appendChild(labelWrapper);
            
            // Generate QR code
            const qrContainer = document.getElementById(`qr-${data.orderId}`);
            qrContainer.innerHTML = ''; // Clear any existing content
            new QRCode(qrContainer, {
                text: `https://www.flashexpress.com/fle/tracking?se=${data.trackingNumber}`,
                width: 60,
                height: 60,
                correctLevel: QRCode.CorrectLevel.H
            });
            
            // Generate barcode
            const barcodeElement = document.getElementById(`barcode-${data.orderId}`);
            JsBarcode(barcodeElement, data.phNumber, {
                format: "CODE128",
                displayValue: false,
                width: 2,
                height: 40,
                margin: 0
            });
            
            // Wait for elements to render
            await new Promise(resolve => setTimeout(resolve, 300));
        }
        
        // Download a single label as PDF - FIXED VERSION
        async function downloadLabelAsPDF(labelId) {
            const labelElement = document.getElementById(labelId);
            if (!labelElement) {
                showNotification('Label not found!');
                return;
            }
            
            showLoading();
            
            try {
                // Wait for elements to render
                await new Promise(resolve => setTimeout(resolve, 300));
                
                // Capture the label as canvas
                const canvas = await html2canvas(labelElement, { 
                    scale: 3,
                    useCORS: true,
                    logging: false
                });
                
                // Extract order ID from labelId (format: label-ORDERID)
                const orderId = labelId.replace('label-', '');
                
                // Convert to image data
                const imgData = canvas.toDataURL('image/png');
                
                // Create PDF
                const pdf = new jsPDF({
                    orientation: 'portrait',
                    unit: 'px',
                    format: [canvas.width, canvas.height]
                });
                
                // Add image to PDF
                pdf.addImage(imgData, 'PNG', 0, 0, canvas.width, canvas.height);
                
                // Save PDF
                pdf.save(`flash-label-${orderId}.pdf`);
                
                showNotification('Label saved as PDF!');
            } catch (error) {
                console.error('Error generating PDF:', error);
                showNotification('Error saving label as PDF');
            } finally {
                hideLoading();
            }
        }
        
        // Download all labels as a single PDF
        async function downloadAllLabelsAsPDF() {
            if (generatedLabels.length === 0) {
                showNotification('No labels to download!');
                return;
            }
            
            showLoading();
            
            try {
                const labelElements = document.querySelectorAll('.shipping-label');
                if (labelElements.length === 0) {
                    showNotification('No labels to download!');
                    return;
                }
                
                // Create a new PDF
                const pdf = new jsPDF({
                    orientation: 'portrait',
                    unit: 'px'
                });
                
                // Process each label
                for (let i = 0; i < labelElements.length; i++) {
                    const element = labelElements[i];
                    
                    // Wait for elements to render
                    await new Promise(resolve => setTimeout(resolve, 300));
                    
                    // Capture the label as canvas
                    const canvas = await html2canvas(element, { 
                        scale: 3,
                        useCORS: true,
                        logging: false
                    });
                    
                    // Convert to image data
                    const imgData = canvas.toDataURL('image/png');
                    
                    // Add a new page for each label (except the first)
                    if (i > 0) {
                        pdf.addPage();
                    }
                    
                    // Set page size to match the label
                    pdf.internal.pageSize.width = canvas.width;
                    pdf.internal.pageSize.height = canvas.height;
                    
                    // Add image to PDF
                    pdf.addImage(imgData, 'PNG', 0, 0, canvas.width, canvas.height);
                }
                
                // Save the combined PDF
                pdf.save(`flash-labels-${new Date().toISOString().slice(0, 10)}.pdf`);
                
                showNotification(`All ${labelElements.length} labels saved as PDF!`);
            } catch (error) {
                console.error('Error generating PDF:', error);
                showNotification('Error saving labels as PDF');
            } finally {
                hideLoading();
            }
        }
        
        // Initialize with one label
        window.onload = function() {
            initializeLocationDropdowns();
            generateSingleLabel();
        };
    </script>
</body>
</html>